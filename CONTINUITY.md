Goal: Deliver cannabis-only official pipeline (discovery/doc-hunt/evidence gating) without touching location logic.
State: checkpoint=.checkpoints/20260120-153013.patch; CI=PASS; Smoke=20/0
Done: CI determinism free-port + smoke contract checks; registry rebuild + missing_sources unification; checkpoint state fix + ledger compact dedupe; machine_verified evidence contract test; OCR/status-claim multi-doc aggregation marked done; wiki trust badge wired from links_trust; wiki refresh SSOT pipeline + offline metrics + MV write guard; network defaults online + wiki ingest/refresh fixes + official scope from portals/allowlist; AGENTS policy updated to allow git ops via commit_if_green and standard responses; data/laws edits allowed without approval via gate; final_response_only guard opt-in only; ci-local supports explicit smoke skip via ALLOW_SMOKE_SKIP=1 with SMOKE_MODE=skip; wiki refresh supports explicit offline fallback via ALLOW_WIKI_OFFLINE=1; quality_gate compares pre/post status instead of requiring empty tree; quality_gate ignores allowed artifacts (ci-final.txt, CONTINUITY.md, Reports/.checkpoints/source_snapshots/backups); quality_gate ignores data/wiki outputs from pass_cycle; commit_if_green stages all changes after gate; removed Next-line generation from CI/ledger output and added guards to block Next lines; stdout contract blocks placeholder lines and sanitizes ci-final output; wiki sync_all + official_badges CLI + new wiki refs/badges files; commit_if_green clears index.lock before commit and bails on unwritable git dir; wiki_claims snapshot supports map format; scheduled wiki sync workflow added; wiki refresh prints NET_MODE/WIKI_MODE and emits FETCH_DIAG on fetch failure; wiki claims ingest adds row_ref + notes_text; sync_all emits WIKI_SYNC (249) + OFFICIAL_BADGE metrics and WIKI_LINKS; official_badges emits OFFICIAL_BADGE totals + per-geo spotlight logs; web API now reads wiki ssot claims from map payload; pass_cycle netcheck reports NET_MODE/WIKI_MODE/NETWORK_DISABLED/WIKI_NETCHECK/OFFLINE and only marks OFFLINE on real net failure; commit_if_green supports -m/--tag args and prod tag override; wiki rec/med parsing fixed for illegal status; offline verify now loads cached refs and reports official/non-official counts; RU blocked only when RU_BLOCKED=1; MV counters align with EMPTY_WRITE_GUARD; wiki claims/refs maps regenerated with fixture refs for target geos; NET_HEALTH probe added with online/offline classification; wiki refresh uses NET_HEALTH gate; snapshot candidates logged per geo; run_checked_verify forces NETWORK for verify; non-official refs allowed for snapshot validation; wiki_claims_store prefers wiki_claims_map for rec/med; pass_cycle step-timeout helper logs STEP_BEGIN/END/TIMEOUT; wiki refresh uses refs cache window to avoid long ref extraction.
Now: CI PASS (NET_HEALTH online=1, OFFLINE=0; smoke 20/0); step timings logged for ci_local/wiki_refresh/wiki_official_eval/auto_facts/checked_verify; wiki metrics geos=267 refs_total=1514 with official/non-official counts; RU/TH/US-CA/XK wiki rec/med populated from map; SNAPSHOT_CANDIDATES and SNAPSHOT_ATTEMPT logged for RU/TH/US-CA/XK with ONLINE snapshots; git ops allowed with push/reset only via gate scripts; commit_if_green supports custom subject/body and optional prod tag; CI can skip smoke only with explicit env override; wiki refresh can fall back to cached claims only with explicit env override.
WIP: Local untracked work pending manual merge; safety snapshot captured.
Open questions: UNCONFIRMED preferred tone for provisional/needs_review banners in UI â€” owner: Vitaliy, due 2026-01-15.
